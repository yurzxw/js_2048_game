const t=new class{constructor(t){this.board=t||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.history=[]}saveState(){this.board&&this.history.push({board:this.board.map(t=>[...t]),score:this.score})}moveLeft(){this.saveState();let t=!1;this.board=this.board.map(e=>{let s=e.filter(t=>0!==t);for(let e=0;e<s.length;e++)s[e]===s[e+1]&&(s[e]*=2,s[e+1]=0,this.score+=s[e],t=!0);let o=s.filter(t=>0!==t);for(;o.length<4;)o.push(0);return o.join("")!==e.join("")&&(t=!0),o}),t&&this.addRandomCell()}moveRight(){this.saveState();let t=!1;this.board=this.board.map(e=>{let s=e.filter(t=>0!==t);for(let e=s.length-1;e>=0;e--)s[e]===s[e-1]&&(s[e]*=2,s[e-1]=0,this.score+=s[e],t=!0);let o=s.filter(t=>0!==t);for(;o.length<4;)o.unshift(0);return o.join("")!==e.join("")&&(t=!0),o}),t&&this.addRandomCell()}moveUp(){this.saveState();let t=!1,e=[[],[],[],[]];for(let t=0;t<4;t++)for(let s=0;s<4;s++)e[s][t]=this.board[t][s];e=e.map(e=>{let s=e.filter(t=>0!==t);for(let e=0;e<s.length;e++)s[e-1]===s[e]&&(s[e-1]*=2,s[e]=0,this.score+=s[e-1],t=!0);let o=s.filter(t=>0!==t);for(;o.length<4;)o.push(0);return o.join("")!==e.join("")&&(t=!0),o});for(let t=0;t<4;t++)for(let s=0;s<4;s++)this.board[t][s]=e[s][t];t&&this.addRandomCell()}moveDown(){this.saveState();let t=!1,e=[[],[],[],[]];for(let t=0;t<4;t++)for(let s=0;s<4;s++)e[s][t]=this.board[t][s];e=e.map(e=>{let s=e.filter(t=>0!==t);for(let e=s.length-1;e>=0;e--)s[e]===s[e-1]&&(s[e]*=2,s[e-1]=0,this.score+=s[e],t=!0);let o=s.filter(t=>0!==t);for(;o.length<4;)o.unshift(0);return o.join("")!==e.join("")&&(t=!0),o});for(let t=0;t<4;t++)for(let s=0;s<4;s++)this.board[t][s]=e[s][t];t&&this.addRandomCell()}getScore(){return this.score}getState(){return this.board.map(t=>[...t])}getStatus(){if(this.board.some(t=>t.includes(2048)))return"win";if(this.board.some(t=>t.includes(0)))return"playing";for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.board[t][e];if(t<3&&s===this.board[t+1][e]||e<3&&s===this.board[t][e+1])return"playing"}return"lose"}start(){this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.addRandomCell(),this.addRandomCell(),this.status="playing"}restart(){this.start()}addRandomCell(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.board[e][s]&&t.push({row:e,col:s});if(t.length>0){let e=Math.floor(Math.random()*t.length),{row:s,col:o}=t[e],r=.9>Math.random()?2:4;this.board[s][o]=r}}undo(){if(this.history.length>0){let t=this.history.pop();this.board=t.board,this.score=t.score}else alert("Undo is not available")}};function e(){let e=t.getState(),s=[...document.querySelectorAll(".field-row")];for(let o=0;o<4;o++)for(let r=0;r<4;r++){let a=s[o].children[r],i=e[o][r];a.textContent!==i&&0!==i&&(a.style.animation="tile-pop 0.3s ease",a.addEventListener("animationend",()=>{a.style.animation=""})),a.style.animation="lose"===t.getStatus()?"none":"tile-pop 0.3s ease",a.textContent=0===i?"":i,a.className="field-cell",0!==i&&a.classList.add(`field-cell--${i}`)}let o=document.querySelector(".game-score"),r=document.querySelector(".message-win");o.textContent=t.getScore();let a=document.querySelector(".message-lose");"lose"===t.getStatus()&&a.classList.remove("hidden"),"win"===t.getStatus()&&r.classList.remove("hidden"),"playing"===t.getStatus()&&(r.classList.add("hidden"),a.classList.add("hidden"))}const s=document.querySelector(".button"),o=document.querySelector(".message-start");let r=!1;s.addEventListener("click",a=>{r?(t.restart(),c=0,t.history=[],u.classList.contains("hidden")||u.classList.add("hidden")):(t.start(),r=!0,o.classList.add("hidden"),s.classList.add("hidden"),s.classList.remove("start"),s.classList.add("restart"),s.classList.remove("hidden"),s.textContent="Restart"),e()}),window.addEventListener("keydown",s=>{if(r){switch(s.preventDefault(),s.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;default:return}e()}});const a=document.querySelector(".game-field");let i=0,l=0,n=0,d=0;function h(s){switch(s){case"up":t.moveUp(),e();break;case"down":t.moveDown(),e();break;case"left":t.moveLeft(),e();break;case"right":t.moveRight(),e()}}a.addEventListener("touchstart",t=>{i=t.touches[0].clientX,l=t.touches[0].clientY}),a.addEventListener("touchmove",t=>{n=t.touches[0].clientX,d=t.touches[0].clientY}),a.addEventListener("touchend",()=>{let t=n-i,e=d-l;Math.abs(t)>Math.abs(e)?t>30?h("right"):t<-30&&h("left"):e>30?h("down"):e<-30&&h("up"),i=0,l=0,n=0,d=0});let c=0;const u=document.querySelector(".message-undo");document.querySelector(".undo").addEventListener("click",s=>{++c<4?(t.undo(),e()):(u.classList.remove("hidden"),setTimeout(()=>{u.classList.add("hidden")},5e3))});
//# sourceMappingURL=index.599c28eb.js.map
